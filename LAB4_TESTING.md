# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã ‚Ññ4 —á–µ—Ä–µ–∑ Swagger

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ—à–∞–≥–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –õ–†4 (SAGA Choreography) —á–µ—Ä–µ–∑ Swagger UI.

## üöÄ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

### 1. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
docker-compose up -d
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã:
- `backend` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π API
- `users-api` ‚Äî —Å–µ—Ä–≤–∏—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `saga-worker` ‚Äî –≤–æ—Ä–∫–µ—Ä –º–æ–¥–µ—Ä–∞—Ü–∏–∏/–ø—Ä–µ–≤—å—é/–ø—É–±–ª–∏–∫–∞—Ü–∏–∏
- `worker` ‚Äî –≤–æ—Ä–∫–µ—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `dlq-worker` ‚Äî –≤–æ—Ä–∫–µ—Ä DLQ
- `redis` ‚Äî –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á
- `push-notificator` ‚Äî push-—Å–µ—Ä–≤–∏—Å

### 2. –û—Ç–∫—Ä—ã—Ç–∏–µ Swagger UI

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
- **Swagger UI**: http://localhost/docs
- **ReDoc**: http://localhost/redoc

### 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è API-–∫–ª—é—á–µ–π (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–¥–µ–ª–∞–Ω–æ)

```bash
docker-compose exec backend python generate_api_keys.py
```

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –æ–¥–∏–Ω –∏–∑ –∫–ª—é—á–µ–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ `.env`:
```env
INTERNAL_API_KEY=<your-key>
```

---

## üìã –ü–æ—à–∞–≥–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `POST /api/users`

**Swagger UI:**
1. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é `users`
2. –í—ã–±–µ—Ä–∏—Ç–µ `POST /api/users`
3. –ù–∞–∂–º–∏—Ç–µ "Try it out"
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:

```json
{
  "email": "author@example.com",
  "username": "testauthor",
  "password": "password123",
  "bio": "Test author for LAB4",
  "image_url": null
}
```

5. –ù–∞–∂–º–∏—Ç–µ "Execute"
6. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ** `id` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –æ—Ç–≤–µ—Ç–∞

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°—Ç–∞—Ç—É—Å: `201 Created`
- –í –æ—Ç–≤–µ—Ç–µ –±—É–¥–µ—Ç –æ–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å `id`, `email`, `username`

---

### –®–∞–≥ 2: –í—Ö–æ–¥ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `POST /api/users/login`

**Swagger UI:**
1. –í—ã–±–µ—Ä–∏—Ç–µ `POST /api/users/login`
2. –ù–∞–∂–º–∏—Ç–µ "Try it out"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:

```json
{
  "email": "author@example.com",
  "password": "password123"
}
```

4. –ù–∞–∂–º–∏—Ç–µ "Execute"
5. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ** `access_token` –∏–∑ –æ—Ç–≤–µ—Ç–∞

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°—Ç–∞—Ç—É—Å: `200 OK`
- –í –æ—Ç–≤–µ—Ç–µ –±—É–¥–µ—Ç `access_token` (JWT)

**–í–∞–∂–Ω–æ:** –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é, –æ–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤.

---

### –®–∞–≥ 3: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Swagger

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:**
1. –í –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ Swagger UI –Ω–∞–π–¥–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"Authorize"** (üîí)
2. –í –ø–æ–ª–µ `Value` –≤—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à JWT —Ç–æ–∫–µ–Ω (–±–µ–∑ —Å–ª–æ–≤–∞ "Bearer")
3. –ù–∞–∂–º–∏—Ç–µ "Authorize"
4. –ù–∞–∂–º–∏—Ç–µ "Close"

–¢–µ–ø–µ—Ä—å –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <token>`

---

### –®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ (—Å—Ç–∞—Ç—É—Å DRAFT)

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `POST /api/articles`

**Swagger UI:**
1. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é `articles`
2. –í—ã–±–µ—Ä–∏—Ç–µ `POST /api/articles`
3. –ù–∞–∂–º–∏—Ç–µ "Try it out"
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:

```json
{
  "title": "–ú–æ–π –ø–µ—Ä–≤—ã–π –ø–æ—Å—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è",
  "description": "–≠—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ SAGA",
  "body": "–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞. –ó–¥–µ—Å—å –º–æ–∂–µ—Ç –±—ã—Ç—å –º–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.",
  "tag_list": ["—Ç–µ—Å—Ç", "–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è", "saga"]
}
```

5. –ù–∞–∂–º–∏—Ç–µ "Execute"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°—Ç–∞—Ç—É—Å: `201 Created`
- –í –æ—Ç–≤–µ—Ç–µ –±—É–¥–µ—Ç –æ–±—ä–µ–∫—Ç —Å—Ç–∞—Ç—å–∏ —Å:
  - `id` ‚Äî UUID –ø–æ—Å—Ç–∞
  - `slug` ‚Äî URL-friendly –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
  - **`status: "DRAFT"`** ‚Äî –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ—Å—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–∞–∫ —á–µ—Ä–Ω–æ–≤–∏–∫
  - `preview_url: null` ‚Äî –ø—Ä–µ–≤—å—é –µ—â–µ –Ω–µ—Ç

**–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ `slug` –ø–æ—Å—Ç–∞ –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤!**

---

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ—Å—Ç–∞ (DRAFT)

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/articles/{slug}`

**Swagger UI:**
1. –í—ã–±–µ—Ä–∏—Ç–µ `GET /api/articles/{slug}`
2. –ù–∞–∂–º–∏—Ç–µ "Try it out"
3. –í –ø–æ–ª–µ `slug` –≤—Å—Ç–∞–≤—å—Ç–µ slug –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —à–∞–≥–∞
4. –ù–∞–∂–º–∏—Ç–µ "Execute"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°—Ç–∞—Ç—É—Å: `200 OK`
- `status: "DRAFT"`
- `preview_url: null`

---

### –®–∞–≥ 6: –ó–∞–ø—Ä–æ—Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ—Å—Ç–∞

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `POST /api/articles/{slug}/publish`

**Swagger UI:**
1. –í—ã–±–µ—Ä–∏—Ç–µ `POST /api/articles/{slug}/publish`
2. –ù–∞–∂–º–∏—Ç–µ "Try it out"
3. –í –ø–æ–ª–µ `slug` –≤—Å—Ç–∞–≤—å—Ç–µ slug –ø–æ—Å—Ç–∞
4. –ù–∞–∂–º–∏—Ç–µ "Execute"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°—Ç–∞—Ç—É—Å: `200 OK`
- –í –æ—Ç–≤–µ—Ç–µ:
  - `status: "PENDING_PUBLISH"` ‚Äî –ø–æ—Å—Ç –ø–µ—Ä–µ—à–µ–ª –≤ —Å—Ç–∞—Ç—É—Å –æ–∂–∏–¥–∞–Ω–∏—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
  - –°–æ–æ–±—â–µ–Ω–∏–µ: "Article publication requested successfully"

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –õ–æ–∫–∞–ª—å–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: —Å—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ `PENDING_PUBLISH`
- –ó–∞–¥–∞—á–∞ `post.moderate` –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –≤ –æ—á–µ—Ä–µ–¥—å Redis
- –ú–æ–¥–µ—Ä–∞—Ü–∏—è –Ω–∞—á–Ω–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `saga-worker`

---

### –®–∞–≥ 7: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –≤–æ—Ä–∫–µ—Ä–∞:**

```bash
docker-compose logs -f saga-worker
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
[INFO] Moderation result for article <id>: APPROVED/REJECTED
[INFO] Preview generation task enqueued for article <id>
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ—Å—Ç–∞:**

–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ `GET /api/articles/{slug}` –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 2-3 —Å–µ–∫—É–Ω–¥—ã.

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã:**
- `PENDING_PUBLISH` ‚Äî –º–æ–¥–µ—Ä–∞—Ü–∏—è –µ—â–µ –∏–¥–µ—Ç
- `PUBLISHED` ‚Äî –º–æ–¥–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞, –ø—Ä–µ–≤—å—é —Å–æ–∑–¥–∞–Ω–æ, –ø–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω
- `REJECTED` ‚Äî –º–æ–¥–µ—Ä–∞—Ü–∏—è –æ—Ç–∫–ª–æ–Ω–∏–ª–∞ –ø–æ—Å—Ç (30% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å)

---

### –®–∞–≥ 8: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ—Å—Ç–∞

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/articles/{slug}`

**Swagger UI:**
1. –í—ã–±–µ—Ä–∏—Ç–µ `GET /api/articles/{slug}`
2. –í—Å—Ç–∞–≤—å—Ç–µ slug –ø–æ—Å—Ç–∞
3. –ù–∞–∂–º–∏—Ç–µ "Execute"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–µ—Å–ª–∏ –º–æ–¥–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞):**
- –°—Ç–∞—Ç—É—Å: `200 OK`
- `status: "PUBLISHED"`
- `preview_url: "https://preview.example.com/articles/{id}/preview.png"` ‚Äî –ø—Ä–µ–≤—å—é —Å–æ–∑–¥–∞–Ω–æ

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
1. ‚úÖ –ú–æ–¥–µ—Ä–∞—Ü–∏—è –æ–¥–æ–±—Ä–∏–ª–∞ –ø–æ—Å—Ç
2. ‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –ø—Ä–µ–≤—å—é
3. ‚úÖ –ü–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω
4. ‚úÖ –ó–∞–¥–∞—á–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –≤ –æ—á–µ—Ä–µ–¥—å

---

### –®–∞–≥ 9: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –≤–æ—Ä–∫–µ—Ä–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**

```bash
docker-compose logs -f worker
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
[INFO] Sending notification for article <id> to subscriber <id>
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000 (push-notificator UI)
2. –ù–∞–∂–º–∏—Ç–µ "Generate Subscription Key"
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `subscription_key`

**–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ subscription_key:**

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `PUT /api/users/me/subscription-key`

**Swagger UI:**
1. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é `user`
2. –í—ã–±–µ—Ä–∏—Ç–µ `PUT /api/users/me/subscription-key`
3. –ù–∞–∂–º–∏—Ç–µ "Try it out"
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ–ª–æ:

```json
{
  "subscription_key": "<your-subscription-key-from-push-ui>"
}
```

5. –ù–∞–∂–º–∏—Ç–µ "Execute"

**–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∞–≤—Ç–æ—Ä–∞:**

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `POST /api/users/subscribe`

**Swagger UI:**
1. –í—ã–±–µ—Ä–∏—Ç–µ `POST /api/users/subscribe`
2. –ù–∞–∂–º–∏—Ç–µ "Try it out"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ–ª–æ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `id` –∞–≤—Ç–æ—Ä–∞ –∏–∑ –®–∞–≥–∞ 1):

```json
{
  "target_user_id": "<author-id-from-step-1>"
}
```

4. –ù–∞–∂–º–∏—Ç–µ "Execute"

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ—Å—Ç–∞ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ!

---

## üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∑–∞—â–∏—â–µ–Ω—ã API-–∫–ª—é—á–∞–º–∏ –∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—ã–π Swagger UI. –î–ª—è –∏—Ö —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ curl

```bash
# –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å—Ç (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —ç–Ω–¥–ø–æ–∏–Ω—Ç)
curl -X GET "http://localhost/internal/articles/{article-id}" \
  -H "Authorization: Token <your-internal-api-key>"

# –û—Ç–∫–ª–æ–Ω–∏—Ç—å –ø–æ—Å—Ç
curl -X POST "http://localhost/internal/articles/{article-id}/reject" \
  -H "Authorization: Token <your-internal-api-key>" \
  -H "Content-Type: application/json" \
  -d '{"reason": "Test rejection"}'
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ Postman/Insomnia

1. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–ø—Ä–æ—Å
2. URL: `http://localhost/internal/articles/{article-id}/reject`
3. Method: `POST`
4. Headers:
   - `Authorization: Token <your-internal-api-key>`
   - `Content-Type: application/json`
5. Body:
```json
{
  "reason": "Test rejection"
}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –æ—à–∏–±–æ–∫

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü—É–±–ª–∏–∫–∞—Ü–∏—è —É–∂–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ—Å—Ç–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ—Å—Ç
2. –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –ø—É–±–ª–∏–∫–∞—Ü–∏—é
3. –î–æ–∂–¥–∏—Ç–µ—Å—å —Å—Ç–∞—Ç—É—Å–∞ `PUBLISHED`
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°—Ç–∞—Ç—É—Å: `400 Bad Request`
- –°–æ–æ–±—â–µ–Ω–∏–µ: "Article must be in DRAFT status to publish. Current status: PUBLISHED"

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—É–±–ª–∏–∫–∞—Ü–∏—è —á—É–∂–æ–≥–æ –ø–æ—Å—Ç–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ—Å—Ç –æ—Ç –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –¥—Ä—É–≥–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —á—É–∂–æ–π –ø–æ—Å—Ç

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°—Ç–∞—Ç—É—Å: `403 Forbidden` –∏–ª–∏ `400 Bad Request`
- –°–æ–æ–±—â–µ–Ω–∏–µ: "You can only publish your own articles"

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∏–∑ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ—Å—Ç
2. –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –ø—É–±–ª–∏–∫–∞—Ü–∏—é (—Å—Ç–∞—Ç—É—Å ‚Üí `PENDING_PUBLISH`)
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°—Ç–∞—Ç—É—Å: `400 Bad Request`
- –°–æ–æ–±—â–µ–Ω–∏–µ: "Article must be in DRAFT status to publish. Current status: PENDING_PUBLISH"

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ –ª–æ–≥–∏

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤—Å–µ—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤:

```bash
# SAGA –≤–æ—Ä–∫–µ—Ä (–º–æ–¥–µ—Ä–∞—Ü–∏—è, –ø—Ä–µ–≤—å—é, –ø—É–±–ª–∏–∫–∞—Ü–∏—è)
docker-compose logs -f saga-worker

# –í–æ—Ä–∫–µ—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
docker-compose logs -f worker

# DLQ –≤–æ—Ä–∫–µ—Ä (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫)
docker-compose logs -f dlq-worker

# Backend API
docker-compose logs -f backend
```

### –ü–æ–∏—Å–∫ –ø–æ –ª–æ–≥–∞–º:

```bash
# –ù–∞–π—Ç–∏ –≤—Å–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ—Å—Ç–∞
docker-compose logs saga-worker | grep "<article-id>"

# –ù–∞–π—Ç–∏ –æ—à–∏–±–∫–∏
docker-compose logs saga-worker | grep -i error

# –ù–∞–π—Ç–∏ –∑–∞–¥–∞—á–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
docker-compose logs saga-worker | grep "moderate"
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- [ ] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –í—Ö–æ–¥ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ —Å–æ–∑–¥–∞–µ—Ç –µ–≥–æ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `DRAFT`
- [ ] –ó–∞–ø—Ä–æ—Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ `PENDING_PUBLISH`
- [ ] –ú–æ–¥–µ—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤–∏–¥–Ω–æ –≤ –ª–æ–≥–∞—Ö `saga-worker`)
- [ ] –ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –ø–æ—Å—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ `PUBLISHED`
- [ ] –ü—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ –ø–æ—Å—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ `REJECTED`
- [ ] –£ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ –µ—Å—Ç—å `preview_url`
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º
- [ ] –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∑–∞—â–∏—â–µ–Ω—ã API-–∫–ª—é—á–∞–º–∏
- [ ] –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤, —Å—Ç–∞—Ç—É—Å–æ–≤)

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Å—Ç –∑–∞—Å—Ç—Ä—è–ª –≤ `PENDING_PUBLISH`

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ `saga-worker`: `docker-compose logs saga-worker`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Redis —Ä–∞–±–æ—Ç–∞–µ—Ç: `docker-compose ps redis`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–æ—Ä–∫–µ—Ä –∑–∞–ø—É—â–µ–Ω: `docker-compose ps saga-worker`
4. –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ —É–ø–∞–ª–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ DLQ: `docker-compose logs dlq-worker`

### –ü—Ä–æ–±–ª–µ–º–∞: JWT —Ç–æ–∫–µ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é (–±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–æ–∫–µ–Ω –Ω–µ –∏—Å—Ç–µ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30 –º–∏–Ω—É—Ç)
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ –∏ –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω

### –ü—Ä–æ–±–ª–µ–º–∞: –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 401

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `INTERNAL_API_KEY` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª—é—á –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (—Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é)
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã: `docker-compose restart`

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–æ–¥–µ—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs saga-worker`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Redis –¥–æ—Å—Ç—É–ø–µ–Ω: `docker-compose ps redis`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤–æ—Ä–∫–µ—Ä–∞: `docker-compose exec saga-worker env | grep REDIS`

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞

### –£—Å–ø–µ—à–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è:

```
1. POST /api/users ‚Üí —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. POST /api/users/login ‚Üí –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω
3. POST /api/articles ‚Üí —Å–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç (DRAFT)
4. POST /api/articles/{slug}/publish ‚Üí –∑–∞–ø—Ä–æ—Å–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é (PENDING_PUBLISH)
5. [–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏] –ú–æ–¥–µ—Ä–∞—Ü–∏—è ‚Üí APPROVED
6. [–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–≤—å—é
7. [–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏] –ü—É–±–ª–∏–∫–∞—Ü–∏—è ‚Üí PUBLISHED
8. [–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º
9. GET /api/articles/{slug} ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å PUBLISHED
```

### –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –º–æ–¥–µ—Ä–∞—Ü–∏–µ–π:

```
1. POST /api/articles ‚Üí —Å–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç (DRAFT)
2. POST /api/articles/{slug}/publish ‚Üí –∑–∞–ø—Ä–æ—Å–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é (PENDING_PUBLISH)
3. [–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏] –ú–æ–¥–µ—Ä–∞—Ü–∏—è ‚Üí REJECTED (30% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å)
4. GET /api/articles/{slug} ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å REJECTED
```

---

## üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

### –¢–µ—Å—Ç –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏:

1. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ—Å—Ç –∏ –∑–∞–ø—Ä–æ—Å–∏—Ç–µ –ø—É–±–ª–∏–∫–∞—Ü–∏—é
2. –î–æ–∂–¥–∏—Ç–µ—Å—å —Å—Ç–∞—Ç—É—Å–∞ `PUBLISHED`
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é
4. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –û—à–∏–±–∫–∞ (–ø–æ—Å—Ç —É–∂–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω)

### –¢–µ—Å—Ç –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ (DLQ):

1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `saga-worker`: `docker-compose stop saga-worker`
2. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ—Å—Ç –∏ –∑–∞–ø—Ä–æ—Å–∏—Ç–µ –ø—É–±–ª–∏–∫–∞—Ü–∏—é
3. –ó–∞–¥–∞—á–∞ –ø–æ–ø–∞–¥–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å, –Ω–æ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç—Å—è
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `saga-worker`: `docker-compose start saga-worker`
5. –ó–∞–¥–∞—á–∞ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç—Å—è, –Ω–æ –µ—Å–ª–∏ —É–ø–∞–¥–µ—Ç –ø–æ—Å–ª–µ –≤—Å–µ—Ö —Ä–µ—Ç—Ä–∞–µ–≤ ‚Üí –ø–æ–ø–∞–¥–µ—Ç –≤ DLQ
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ `dlq-worker` –¥–ª—è –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É—é—â–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **Swagger UI**: http://localhost/docs
- **ReDoc**: http://localhost/redoc
- **Push Notificator UI**: http://localhost:8000
- **Health Check**: http://localhost/health

---

**–£–¥–∞—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è! üöÄ**

